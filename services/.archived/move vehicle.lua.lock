local keys = {
   forward = keybinds:fromVanilla("key.forward"),
   back = keybinds:fromVanilla("key.back"),
   left = keybinds:fromVanilla("key.left"),
   up = keybinds:fromVanilla("key.jump"),
   right = keybinds:fromVanilla("key.right"),
}

events.TICK:register(function ()
   local vehicle = player:getVehicle()
   if vehicle then
      local stringVel = {}
      local vel = vectors.vec3()
      local mat = matrices.mat4():rotateY(-player:getRot().y):scale(1)
      if keys.forward:isPressed() then
         vel = vel + mat.c3.xyz
      end
      if keys.back:isPressed() then
         vel = vel - mat.c3.xyz
      end
      if keys.left:isPressed() then
         vel = vel + mat.c1.xyz
      end
      if keys.right:isPressed() then
         vel = vel - mat.c1.xyz
      end
      if keys.up:isPressed() then
         vel.y = 0.8
      else
         vel.y = -0.5
      end
      vel.x = math.floor(vel.x * 10000) / 10000
      if vel.x == math.floor(vel.x) then
         stringVel[1] = tostring(vel.x) .. ".0"
      else
         stringVel[1] = tostring(vel.x)
      end
      vel.y = math.floor(vel.y * 10000) / 10000
      if vel.y == math.floor(vel.y) then
         stringVel[2] = tostring(vel.y) .. ".0"
      else
         stringVel[2] = tostring(vel.y)
      end
      vel.z = math.floor(vel.z * 10000) / 10000
      if vel.z == math.floor(vel.z) then
         stringVel[3] = tostring(vel.z) .. ".0"
      else
         stringVel[3] = tostring(vel.z)
      end
      host:sendChatCommand("/execute on vehicle run data merge entity @s {Motion:["..stringVel[1]..","..stringVel[2]..","..stringVel[3].."]}")
   end
end)